# Aim 1

The model for Aim 1 will be a random intercept linear model.
Estimation will use the *lme4* package.

```{r}
citation("lme4")
```

The model is

$$
\begin{align*}
y_{i j} = & \beta_0 \\
          & + \beta_1 x_{\text{placebo}, i} + \beta_2 x_{\text{month 3}, i} + \beta_3 x_{\text{month 12}, i} \\
          & + \beta_4 x_{\text{placebo}, i} x_{\text{month 3}, i} + \beta_5 x_{\text{placebo}, i} x_{\text{month 12}, i} \\
          & + u_j + e_{i j} \\
\end{align*}
$$

where $u_j$ is the random intercept component and $e_{i j}$ is the random error.


## Normalized GSH:GSSG concentration ratio

![figures/lineplotNormalizedConcRatio.png](figures/lineplotNormalizedConcRatio.png)

```{r}
G <-
  df1 %>% 
  ggplot(aes(y = normalizedConcRatio, x = factor(visitMonth), group = patientID, color = studyArm)) +
  geom_line() +
  geom_point() +
  facet_wrap(~ studyArm) +
  scale_x_discrete("Visit month") +
  scale_y_continuous("Normalized concentration GSH:GSSG ratio") +
  theme_bw() +
  theme(legend.position = "none",
        panel.grid.minor = element_blank())
ggsave("figures/lineplotNormalizedConcRatio.svg", width = 6, height = 4)
ggsave("figures/lineplotNormalizedConcRatio.png", width = 6, height = 4)
```

![figures/plotNormalizedConcSlope.png](figures/plotNormalizedConcSlope.png)

```{r}
G <-
  df1 %>% 
  ggplot() +
  aes(x = normalizedConcGSSG, y = normalizedConcGSH) +
  geom_smooth(method = "lm", formula = y ~ x, se = FALSE) +
  geom_point() +
  scale_x_continuous("Normalized concentration GSSG (nmol/mg)") +
  scale_y_continuous("Normalized concentration GSH (nmol/mg)") +
  facet_grid(studyArm ~ visitMonth) +
  theme_bw() +
  theme(panel.grid.minor = element_blank())
ggsave("figures/plotNormalizedConcSlope.svg", width = 6, height = 4)
ggsave("figures/plotNormalizedConcSlope.png", width = 6, height = 4)
```

Mixed effects model using the **lme4** package.

```{r normalizedConcRatio-lme4}
M <- lmer(normalizedConcRatio ~ studyArm * visitMonth + (1 | patientID),
          data = df1)
tidy(M) %>% kable(digits = 2)
summary(M)
plot(ranef(M))
res <- residuals(M)
plot(res)
qqnorm(res)
plot(M)
rm(M, res)
```

Mixed effects model using the **nlme** package.

*Not executed.*
The `lme4::lmer()` function is good enough.

```{r normalizedConcRatio-nlme, eval = FALSE}
M <- lme(normalizedConcRatio ~ studyArm * visitMonth,
         random = ~ 1 | patientID / visitMonth,
         correlation = corAR1(),
         data = df1)
tidy(M, effects = "fixed") %>% kable(digits = c(0, 2, 2, 2, 4))
summary(M)
plot(ranef(M))
res <- residuals(M)
plot(res)
qqnorm(res)
plot(M)
rm(M, res)
```


## Normalized concentration GSH

![figures/lineplotNormalizedConcGSH.png](figures/lineplotNormalizedConcGSH.png)

```{r}
G <-
  df1 %>% 
  ggplot(aes(y = normalizedConcGSH, x = visitMonth, group = patientID, color = studyArm)) +
  geom_line() +
  geom_point() +
  facet_wrap(~ studyArm) +
  scale_x_discrete("Visit month") +
  scale_y_continuous("Normalized concentration GSH (nmol/mg)") +
  theme_bw() +
  theme(legend.position = "none")
ggsave("figures/lineplotNormalizedConcGSH.svg", width = 6, height = 4)
ggsave("figures/lineplotNormalizedConcGSH.png", width = 6, height = 4)
```

Mixed effects model using the **lme4** package.

```{r normalizedConcGSH-lme4}
M <- lmer(normalizedConcGSH ~ studyArm * visitMonth + (1 | patientID),
          data = df1)
tidy(M) %>% kable(digits = 2)
summary(M)
plot(ranef(M))
res <- residuals(M)
plot(res)
qqnorm(res)
plot(M)
rm(M, res)
```

Mixed effects model using the **nlme** package.

*Not executed.*
The `lme4::lmer()` function is good enough.

```{r normalizedConcGSH-nlme, eval = FALSE}
M <- lme(normalizedConcGSH ~ studyArm * visitMonth,
         random = ~ 1 | patientID / visitMonth,
         correlation = corAR1(),
         data = df1)
tidy(M, effects = "fixed") %>% kable(digits = c(0, 2, 2, 2, 4))
summary(M)
plot(ranef(M))
res <- residuals(M)
plot(res)
qqnorm(res)
plot(M)
rm(M, res)
```


## Normalized concentration GSSG

![figures/lineplotNormalizedConcGSSG.png](figures/lineplotNormalizedConcGSSG.png)

```{r}
G <-
  df1 %>% 
  ggplot(aes(y = normalizedConcGSSG, x = visitMonth, group = patientID, color = studyArm)) +
  geom_line() +
  geom_point() +
  facet_wrap(~ studyArm) +
  scale_x_discrete("Visit month") +
  scale_y_continuous("Normalized concentration GSSG (nmol/mg)") +
  theme_bw() +
  theme(legend.position = "none")
ggsave("figures/lineplotNormalizedConcGSSG.svg", width = 6, height = 4)
ggsave("figures/lineplotNormalizedConcGSSG.png", width = 6, height = 4)
```

Mixed effects model using the **lme4** package.

```{r normalizedConcGSSG-lme4}
M <- lmer(normalizedConcGSSG ~ studyArm * visitMonth + (1 | patientID),
          data = df1)
tidy(M) %>% kable(digits = 2)
summary(M)
plot(ranef(M))
res <- residuals(M)
plot(res)
qqnorm(res)
plot(M)
rm(M, res)
```

Mixed effects model using the **nlme** package.

*Not executed.*
The `lme4::lmer()` function is good enough.

```{r normalizedConcGSSG-nlme, eval = FALSE}
M <- lme(normalizedConcGSSG ~ studyArm * visitMonth,
         random = ~ 1 | patientID / visitMonth,
         correlation = corAR1(),
         data = df1)
tidy(M, effects = "fixed") %>% kable(digits = c(0, 2, 2, 2, 4))
summary(M)
plot(ranef(M))
res <- residuals(M)
plot(res)
qqnorm(res)
plot(M)
rm(M, res)
```


## Interpretation
